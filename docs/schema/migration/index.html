<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.9">
<title data-react-helmet="true">How do I migrate a schema? | Glean</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://glean.software/docs/schema/migration/"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How do I migrate a schema? | Glean"><meta data-react-helmet="true" name="description" content="TL;DR:"><meta data-react-helmet="true" property="og:description" content="TL;DR:"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://glean.software/docs/schema/migration/"><link data-react-helmet="true" rel="alternate" href="https://glean.software/docs/schema/migration/" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://glean.software/docs/schema/migration/" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f50afc48.css">
<link rel="preload" href="/assets/js/runtime~main.107b5819.js" as="script">
<link rel="preload" href="/assets/js/main.87764d74.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script>
<div style="display: none; text-align: center; background-color: white; color: black;" id="internaldocs-banner"></div><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title">Glean</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/introduction/">Documentation</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/glean" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="toggle_71bT toggle_3Zt9 toggleDisabled_3cF-"><div class="toggleTrack_32Fl" role="button" tabindex="-1"><div class="toggleTrackCheck_3lV7"><span class="toggleIcon_O4iE">ðŸŒœ</span></div><div class="toggleTrackX_S2yS"><span class="toggleIcon_O4iE">ðŸŒž</span></div><div class="toggleTrackThumb_xI_Z"></div></div><input type="checkbox" class="toggleScreenReader_28Tw" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_35hR" type="button"></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Quick Start</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">User Guide</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Schemas</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/schema/basic/">Basic Concepts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/schema/types/">Built-in Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/schema/syntax/">Syntax</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/schema/recursion/">Recursion</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/schema/changing/">Changing a schema</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/schema/migration/">Migrating a schema</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/schema/workflow/">Workflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/schema/thrift/">Thrift and JSON</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Querying</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/derived/">Derived Predicates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/databases/">Glean Databases</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/write/">Writing data to Glean</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/running/">Running the Tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/shell/">Using the Shell</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/server/">Running the Glean Server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/cli/">The Glean CLI tool</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Indexers</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_1lV3"><div class="docItemContainer_zt2Y"><article><header><h1 class="docTitle_1y8q">How do I migrate a schema?</h1></header><div class="markdown"><header><h1>Migrating schemas</h1></header><p>TL;DR:</p><ul><li>Make only backwards compatible changes in schema migrations.</li><li>Always update the indexer and schema at the same time.</li><li>Use the <code>evolves</code> feature to guarantee clients donâ€™t break during the migration.</li></ul><hr><p>Migrating schemas in Glean doesnâ€™t need to be hard, but to ensure there will be no disruption of live services you need to consider multiple parts of the system.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="guiding-example">Guiding example<a aria-hidden="true" class="hash-link" href="#guiding-example" title="Direct link to heading">â€‹</a></h2><p>This guide will walk through an example migration and explain the main points to be taken into account in the process. It assumes you are familiar with the <a href="https://www.internalfb.com/intern/staticdocs/glean/docs/schema/changing/#schema-migrations-with-backward-compatible-changes" target="_blank" rel="noopener noreferrer"><code>evolves</code> feature.</a></p><p>To start suppose you use the following schema to represent classes and their methods.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema code.1 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    predicate Class : { name: string }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    predicate Method : { class : Class, name : string }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema all.1 : code.1 {}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The goal will be to augment the representation to support storing whether a method is static or not.</p><p>To do that you will need to add a field to the <code>Method</code> predicate. This change requires you to create a new version of the schema (see <a href="https://www.internalfb.com/intern/staticdocs/glean/docs/schema/changing/" target="_blank" rel="noopener noreferrer">How do I change a schema</a>). You will also need a new version of the <code>all</code> schema (see <strong><em>Version Resolution</em></strong>).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema code.2 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    predicate Class : { name: string }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    predicate Method : { class : Class, name : string, static: bool }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema code.2 evolves code.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema all.2 : code.2 {}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Keep in mind that <code>code.2 { predicate Method { class: Class, ..}}</code> is just syntactic sugar for <code>predicate code.Method.2 { class: code.Class.2, ...}</code> so when we say updating a schema, what we really mean is updating all the individual predicates in a schema. Each predicate is independent</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="changing-the-schema-files">Changing the schema files<a aria-hidden="true" class="hash-link" href="#changing-the-schema-files" title="Direct link to heading">â€‹</a></h2><p>This <code>code</code> schema might live in some path in the project like <code>/schema/source/code.angle</code>.
It is worth having an archive folder such as <code>/schema/source/archive/</code> where old versions are moved to. We cannot remove an old schema version while there may still be clients using it.
By having an archive directory the original file can contain only the most current version of the schema and the changes between versions are shown much more clearly in version control.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="deploying-changes">Deploying changes<a aria-hidden="true" class="hash-link" href="#deploying-changes" title="Direct link to heading">â€‹</a></h2><p>You need a plan to deploy this update. Letâ€™s start by looking at the initial state of the system.</p><img src="/assets/images/migration-before-f6a81cf38e48e3bad614aa0164b327a6.png" alt="System diagram - before migration"><p>The <em>Indexer</em> generates facts and sends them to the <em>Glean Write Server</em>. The write server will use the <em>Schemas</em> to determine the shape each saved fact should have and save them to a <em>Database</em>. The <em>Schemas</em> used during the creation of the <em>Database</em> will be saved into the database itself and will determine how the Query Server should interpret client queries.</p><p>In the diagram we can see that there are two types of clients:</p><ul><li>Clients that make versioned queries, that is with predicate versions (e.g. <code>code.Method.1 _</code>).<ul><li>These are usually using a DSL such as the Hack or Haskell ones and use Thrift or a binary encoding of the results. If there is any unexpected bit in the result decoding will fail.</li><li>If a specific version is requested the server will only return facts with exactly the expected shape.</li><li>Although one can omit predicate versions in the Haskell and Hack DSLs these libraries will still create queries with explicit version numbers. The libraries use code generation and the version numbers are determined at compilation time.</li></ul></li><li>Clients that make unversioned queries, without predicate versions (e.g. <code>code.Method _</code>).<ul><li>These are applications using clients without a DSL (like the Python client) or constructing their queries using strings, like in <code>glean shell</code>.</li><li>They receive results in JSON.</li><li>The server will determine the version to be used based on the standard <strong><em>Version Resolution</em></strong> procedure.</li></ul></li></ul><p>When you create a new schema version you also create new versions of all predicates inside that schema. If we are not careful in the process of updating the indexers and clients we could end up in a situation where clients are expecting predicates of one version and the server is operating on predicates of a different one.</p><p>This could lead to two problems when deploying changes:</p><ol><li>Clients breaking with unexpected response content.<ol><li>A type changes in a backwards incompatible way in a schema migration and clients issuing unversioned queries start getting the new type with the unexpected shape.</li></ol></li><li>Clients getting empty responses.<ol><li>Client requests <code>code.Method.1</code> but the db only has <code>code.Method.2</code> and <code>code.2</code> doesnâ€™t evolve <code>code.1</code></li><li>Client requests <code>code.Method.2</code> but the database only has <code>code.Method.1</code> facts.</li></ol></li></ol><p>The way to avoid problem 1 is to never create backwards incompatible changes. If you need such a change it is best to create a schema with a different name and have the indexer create facts for both old and new schemas while all clients are being updated.</p><p>Problem number 2 can be eliminated by deploying new schemas, indexers and clients in the following order and using the <code>evolves</code> feature to guarantee that all clients work during the transition:</p><ol><li>Stop running indexers using your schema.</li><li>Publish the new schema.</li><li>Deploy the updated indexer</li><li>Enable indexing using your schema again.</li><li>Wait until a database with the new schema is created.</li><li>Update clients.</li></ol><p>Step 5 ensures that we donâ€™t update clients before the server is using a database capable of answering their new queries.</p><p>The diagram below shows the intermediate state of the system after step 5 but before we have updated all clients. Changes are in bold. The blue text represents facts from the new schema transformed through the <code>evolves</code>  feature into the shape of facts from the old schema to answer versioned queries from non-updated clients.</p><img src="/assets/images/migration-after-61c0e0d94c886aaae9506c4b92ae9198.png" alt="System diagram - after migration"><p>Now that the server side is done clients can be updated at their leisure.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="schema-dependencies">Schema Dependencies<a aria-hidden="true" class="hash-link" href="#schema-dependencies" title="Direct link to heading">â€‹</a></h2><p>There might be many schemas that depend on <code>code.1</code>. If you need to update them to import <code>code.2</code> instead you will need to create new versions of them as well. You will need to update dependant schemas if:</p><ul><li>A schema uses predicates/types from the old schema in a predicate/type.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema inheritance.1 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   import code.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   predicate Inherits : { child: code.Class, parent: code.Class }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>A schema use predicates/types from the old schema in the derivation of a stored predicate.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema inheritance.roots.1 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   import code.1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   predicate IsRoot : Class</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        stored C where</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            C = code.Class _ ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            !(Inherits { child = C });</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If a dependant schema only uses types from the old schema in the derivation of non-stored predicates there is no need to create a new schema version.</p><p>If you create a new version of a dependant schema you may also need to create new versions for the schemas that depend on it and so on. The criterion for whether that is needed is the same as the one above.</p><p>New versions of dependant schemas should evolve the old dependant schema version and should be added to the new <code>all</code> schema.</p><p>Letâ€™s now look in a bit more detail into how clients issuing unversioned queries are affected by the migration.</p><h2 class="anchor anchorWithStickyNavbar_31ik" id="version-resolution">Version Resolution<a aria-hidden="true" class="hash-link" href="#version-resolution" title="Direct link to heading">â€‹</a></h2><p>To answer queries without explicit versions the server must determine a version to be used for each predicate and type in the query.</p><p>Each predicate has a version, which is derived from the name of its schema.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema src.1 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    predicate File : string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The schema above defines the predicate <code>src.File.1</code>.</p><p>When a query is sent to a Glean server it may or may not include the version of the predicate it wants.</p><ul><li><code>src.File.1 _</code> - Query to fetch all facts from this exact predicate.</li><li><code>src.File _</code> - Omit predicate version number and let the server determine what version should be used.</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="the-all-schema">The <code>all</code> schema<a aria-hidden="true" class="hash-link" href="#the-all-schema" title="Direct link to heading">â€‹</a></h3><p>To determine what predicate to return when the server receives an unversioned query Glean uses a special schema named <code>all</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema all.1 : src.1 {}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The statement above means that with <code>all.1</code> any unversioned predicate with the <code>src</code> qualification should be interpreted as being part of the <code>src.1</code> schema. That is, the query <code>src.File _</code> should be interpreted as <code>src.File.1 _</code>.</p><p>When there are multiple versions of the <code>all</code> schema available, the Glean server will apply these rules (in this order) to establish which one should be used:</p><ul><li>The version specified in the <code>schema_version</code> field of the query request. By default clients donâ€™t specify this field.</li><li>The latest version of <code>all</code> at the time the database was created. This is stored in the database property <code>glean.schema_version</code>, which can be seen with the command <code>:describe</code> in the shell.</li></ul><p>Here is a full example. Suppose we create a database using a schema file with the following content:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema src.1 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    predicate File : string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema src.2 {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    predicate File : { name : string, executable : bool }</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema all.1 : src.1 {}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema all.2 : src.2 {}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The database will use <code>all.2</code> as its schema for version resolution and this is the outcome of the following queries:</p><ul><li><code>src.File _</code> - Will yield results of type <code>src.File.2</code>.</li><li><code>src.File.2 _</code> - Will yield results of type <code>src.File.2</code>.</li><li><code>src.File &quot;/tools&quot;..</code> - Error. Because it resolves to <code>src.File.2</code> this is a type mismatch as the predicate content is a record and not a string.</li></ul><h3 class="anchor anchorWithStickyNavbar_31ik" id="conflict-resolution">Conflict resolution<a aria-hidden="true" class="hash-link" href="#conflict-resolution" title="Direct link to heading">â€‹</a></h3><p>If we had</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema all.2 : src.1, src.2 {}</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>What would <code>src.File _</code> resolve to? When multiple versions are available in the <code>all</code> schema, the type or predicate with the highest version number is selected. In this case <code>src.File.2</code>.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div></div><br><div class="row"><div class="col"><a href="https://github.com/facebookincubator/Glean/tree/main/glean/website/docs/schema/migration.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/schema/changing/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« <!-- -->Changing a schema</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/schema/workflow/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Workflow<!-- --> Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#guiding-example" class="table-of-contents__link toc-highlight">Guiding example</a></li><li><a href="#changing-the-schema-files" class="table-of-contents__link toc-highlight">Changing the schema files</a></li><li><a href="#deploying-changes" class="table-of-contents__link toc-highlight">Deploying changes</a></li><li><a href="#schema-dependencies" class="table-of-contents__link toc-highlight">Schema Dependencies</a></li><li><a href="#version-resolution" class="table-of-contents__link toc-highlight">Version Resolution</a><ul><li><a href="#the-all-schema" class="table-of-contents__link toc-highlight">The <code>all</code> schema</a></li><li><a href="#conflict-resolution" class="table-of-contents__link toc-highlight">Conflict resolution</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction/">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/MetaOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/facebookincubator/glean" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_MyFc"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--light_3UqQ footer__logo"><img src="/img/oss_logo.png" alt="Facebook Open Source Logo" class="themedImage_1VuW themedImage--dark_hz6m footer__logo"></a></div><div class="footer__copyright">Copyright Â© 2022 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.107b5819.js"></script>
<script src="/assets/js/main.87764d74.js"></script>
</body>
</html>